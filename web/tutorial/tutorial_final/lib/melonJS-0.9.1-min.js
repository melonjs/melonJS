/*!
 * MelonJS Game Engine
 * Copyright (C) 2011, Olivier BIOT
 * http://www.melonjs.org
 * 
 * melonJS is licensed under a Creative Commons 
 * Attribution-NonCommercial-NoDerivs 3.0 Unported License.
 * http://creativecommons.org/licenses/by-nc-nd/3.0/
 *
 * @author Olivier Biot 2011
 *
 */
(function(g,b){var k=g.document;me={mod:"melonJS",nocache:"",audio:null,video:null,timer:null,input:null,state:null,game:null,entityPool:null,levelDirector:null,XMLParser:null,loadingScreen:null,TMXTileMap:null};me.debug={displayFPS:false,renderHitBox:false,renderDirty:false};me.sys={ua:navigator.userAgent.toLowerCase(),sound:false,storage:false,gyro:(g.DeviceMotionEvent!==b),fps:60,interpolation:false,scale:1,useNativeAnimFrame:false,cacheImage:false,dirtyRegion:false};g.me=me;var h=false;var i=false,j=false,m=[];function c(){if(!j){if(!k.body){return setTimeout(c,13)}if(k.removeEventListener){k.removeEventListener("DOMContentLoaded",c,false)}else{g.removeEventListener("load",c,false)}j=true;for(var n=0;n<m.length;n++){m[n].call(g,[])}m=[]}}function f(){if(i){return}i=true;if(k.addEventListener){k.addEventListener("DOMContentLoaded",c,false)}g.addEventListener("load",c,false)}onReady=function(n){f();if(j){n.call(g,[])}else{m.push(function(){return n.call(g,[])})}return this};g.onReady(function(){a()});var e=false,l=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;Object.extend=function(s){var q=this.prototype;e=true;var r=new this();e=false;for(var o in s){r[o]=typeof s[o]=="function"&&typeof q[o]=="function"&&l.test(s[o])?(function(t,u){return function(){var w=this.parent;this.parent=q[t];var v=u.apply(this,arguments);this.parent=w;return v}})(o,s[o]):s[o]}function n(){if(!e&&this.init){this.init.apply(this,arguments)}}n.prototype=r;n.constructor=n;n.extend=arguments.callee;return n};if(typeof Object.create!=="function"){Object.create=function(n){function q(){}q.prototype=n;return new q()}}if(!Function.bind){Function.prototype.bind=function(){var q=this,o=Array.prototype.slice.call(arguments),n=o.shift();return function(){return q.apply(n,o.concat(Array.prototype.slice.call(arguments)))}}}if(!Object.defineProperty){Object.defineProperty=function(n,q,o){if(n.__defineGetter__){if(o.get){n.__defineGetter__(q,o.get)}if(o.set){n.__defineSetter__(q,o.set)}}else{throw"melonJS: Object.defineProperty not supported"}}}String.prototype.trim=function(){return(this.replace(/^\s+/,"")).replace(/\s+$/,"")};String.prototype.isNumeric=function(){return(this!=null&&!isNaN(this)&&this.trim()!="")};String.prototype.isBoolean=function(){return(this!=null&&("true"==this.trim()||"false"==this.trim()))};String.prototype.contains=function(n){return this.indexOf(n)>-1};Number.prototype.clamp=function(n,o){return this<n?n:this>o?o:this};Number.prototype.random=function(o,n){return(~~(Math.random()*(n-o+1))+o)};Number.prototype.round=function(){num=(arguments.length==1)?this:arguments[0];powres=Math.pow(10,arguments[1]||arguments[0]);return(Math.round(num*powres)/powres)};Number.prototype.toHex=function(){return"0123456789ABCDEF".charAt((this-this%16)>>4)+"0123456789ABCDEF".charAt(this%16)};function d(){var n={xmlDoc:null,parser:null,parseFromString:function(o){if(g.DOMParser){parser=new DOMParser();xmlDoc=parser.parseFromString(o,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(o)}if(xmlDoc==null){console.log("xml "+xmlDoc+" not found!")}},getFirstElementByTagName:function(o){return xmlDoc?xmlDoc.getElementsByTagName(o)[0]:null},getAllTagElements:function(){return xmlDoc?xmlDoc.getElementsByTagName("*"):null},getStringAttribute:function(q,s,r){var o=q.getAttribute(s);return o?o.trim().toLowerCase():r},getIntAttribute:function(q,s,r){var o=this.getStringAttribute(q,s,r);return o?parseInt(o):r},getFloatAttribute:function(q,s,r){var o=this.getStringAttribute(q,s,r);return o?parseFloat(o):r},getBooleanAttribute:function(q,s,r){var o=this.getStringAttribute(q,s,r);return o?(o=="true"):r},free:function(){xmlDoc=null;parser=null}};return n}function a(){if(h){return}var n=k.createElement("audio");me.utils.setNocache(k.location.href.match(/\?nocache/));if(n.canPlayType){me.audio.capabilities.mp3=("no"!=n.canPlayType("audio/mpeg"))&&(""!=n.canPlayType("audio/mpeg"));me.audio.capabilities.ogg=("no"!=n.canPlayType('audio/ogg; codecs="vorbis"'))&&(""!=n.canPlayType('audio/ogg; codecs="vorbis"'));me.audio.capabilities.wav=("no"!=n.canPlayType('audio/wav; codecs="1"'))&&(""!=n.canPlayType('audio/wav; codecs="1"'));me.sys.sound=me.audio.capabilities.mp3||me.audio.capabilities.ogg||me.audio.capabilities.wav}if((me.sys.ua.search("iphone")>-1)||(me.sys.ua.search("ipod")>-1)||(me.sys.ua.search("ipad")>-1)||(me.sys.ua.search("android")>-1)){me.sys.sound=false}me.timer.init();me.XMLParser=new d();me.loadingScreen=new me.DefaultLoadingScreen();me.state.init();me.entityPool.init();me.levelDirector.reset();h=true}dirtyRegion=(function(){var n={};var o=[];n.makeDirty=function(q){o.push(q)};n.draw=function(r){for(var q=o.length,s;q--,s=o[q];){s.draw(r,"white")}};n.flush=function(){o=[]};return n})();game=(function(){var t={};var w=0;var u=0;var v=null;var s=[];var n=0;var r=true;var q=false;var o=[];t.viewport=null;t.HUD=null;t.collisionMap=null;t.currentLevel=null;t.NO_OBJECT=0;t.ENEMY_OBJECT=1;t.COLLECTABLE_OBJECT=2;t.ACTION_OBJECT=3;t.init=function(A,C,B,z){if(!q){A=A||0;C=C||0;var B=B||me.video.getWidth();var z=z||me.video.getHeight();spriteCanvasSurface=me.video.createCanvasSurface(B,z);t.viewport=new me.Viewport(0,0,B,z);v=me.video.getScreenFrameBuffer();q=true}};t.reset=function(){if(!q){t.init()}t.removeAll();if(t.viewport){t.viewport.reset()}r=true;if(t.HUD!=null){t.add(t.HUD)}};t.loadTMXLevel=function(C){t.currentLevel=C;t.collisionMap=t.currentLevel.getLayerByName("collision");if(!t.collisionMap||!t.collisionMap.isCollisionMap){alert("WARNING : no collision map detected")}t.currentLevel.addTo(me.game);t.viewport.setBounds(t.currentLevel.realwidth,t.currentLevel.realheight);var z=t.currentLevel.getObjectGroups();for(var B=0;B<z.length;B++){for(var A=0;A<z[B].objects.length;A++){t.addEntity(z[B].objects[A],z[B].z)}}t.sort()};t.add=function(z,A){z.z=(A)?A:z.z;s.push(z);if(z.mouseEvent){o.push(z)}n=s.length};t.addEntity=function(z,A){t.add(me.entityPool.newIstanceOf(z),A)};t.addHUD=function(z,D,A,C,B){if(t.HUD==null){t.HUD=new me.HUD_Object(z,D,A,C,B);t.add(t.HUD)}};t.disableHUD=function(){if(t.HUD!=null){t.remove(t.HUD);t.HUD=null}};t.mouseEvent=function(z,B){for(var A=o.length;A--;){o[A].mouseEvent(z,B)}};t.update=function(){me.timer.update();for(var z=n,A;z--,A=s[z];){if(A.update()){if(me.sys.dirtyRegion&&A.getRect){dirtyRegion.makeDirty(A.getRect())}r=true}if(A.isEntity&&!A.flickering){A.visible=t.viewport.isVisible(A.collisionBox)}}r=t.viewport.update(r)};t.remove=function(z){s.splice(s.indexOf(z),1);if(z.mouseEvent){o.splice(o.indexOf(z),1)}n=s.length;r=true};t.removeAll=function(){n=0;s=[];o=[];r=true};t.sort=function(){s.sort(function(A,z){return(z.z-A.z)});r=true};t.collide=function(A){var z=null;for(var B=n,C;B--,C=s[B];){if(C.visible&&C.collidable&&C.isEntity){if(z=C.checkCollision(A)){break}}}return z};t.repaint=function(){r=true};t.draw=function(){if(r){for(var z=n,A;z--,A=s[z];){if(A.visible){A.draw(spriteCanvasSurface,w,u)}}t.viewport.draw(spriteCanvasSurface);if(me.sys.dirtyRegion&&me.debug.renderDirty){dirtyRegion.draw(spriteCanvasSurface);dirtyRegion.flush()}v.drawImage(spriteCanvasSurface.canvas,w,u);r=false}};return t})();ScreenObject=Object.extend({visible:true,init:function(n){this.visible=(n===true)||false},reset:function(){me.game.reset();if(this.visible){me.game.add(this,999)}this.onResetEvent.apply(this,arguments);me.game.sort()},destroy:function(){this.onDestroyEvent()},update:function(){return false},onUpdateFrame:function(){me.game.update();me.game.draw();me.video.blitSurface()},draw:function(){},onResetEvent:function(){},onDestroyEvent:function(){}});g.me.ScreenObject=ScreenObject;window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){return -1}})();window.cancelRequestAnimFrame=(function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||function(){return -1}})();state=(function(){var v={};var s=-1;var C=-1;var r=-1;var w={};var n={color:"",duration:0};var q=null;var z=null;var A=null;var u=null;function t(){if((C==-1)&&(r==-1)){me.timer.reset();if(me.sys.useNativeAnimFrame){r=window.requestAnimFrame(D);if(r!=-1){return}me.sys.useNativeAnimFrame=false}C=setInterval(A,u)}}function D(){A();window.requestAnimFrame(D)}function o(){if(C!=-1){clearInterval(C);C=-1}if(r!=-1){cancelRequestAnimFrame(r);r=-1}}function B(E){o();if(w[s]){w[s].screen.destroy()}w[E].screen.reset.apply(w[E].screen,z);s=E;A=w[s].screen.onUpdateFrame;t();if(q){q()}}v.LOADING=0;v.MENU=1;v.READY=2;v.PLAY=3;v.GAMEOVER=4;v.GAME_END=5;v.SCORE=6;v.CREDITS=7;v.SETTINGS=8;v.onPause=null;v.onResume=null;v.init=function(){v.set(v.LOADING,me.loadingScreen);g.addEventListener("blur",function(){if(s!=v.LOADING){v.pause(true);if(v.onPause){v.onPause()}}},false);g.addEventListener("focus",function(){if(s!=v.LOADING){v.resume(true);if(v.onResume){v.onResume()}me.game.repaint()}},false);u=~~(1000/me.sys.fps)};v.pause=function(E){o();if(E){me.audio.pauseTrack()}};v.resume=function(E){t(s);if(E){me.audio.resumeTrack()}};v.set=function(E,F){w[E]={};w[E].screen=F;w[E].transition=true};v.current=function(){return w[s].screen};v.transition=function(F,E,G){if(F=="fade"){n.color=E;n.duration=G}};v.setTransition=function(F,E){w[F].transition=E};v.change=function(E){switch(E){case v.LOADING:case v.MENU:case v.PLAY:case v.READY:case v.GAMEOVER:case v.GAME_END:case v.SCORE:case v.CREDITS:case v.SETTINGS:z=null;if(arguments.length>1){z=Array.prototype.slice.call(arguments,1)}if(n.duration&&w[E].transition){q=function(){me.game.viewport.fadeOut(n.color,n.duration)};me.game.viewport.fadeIn(n.color,n.duration,function(){B(E)})}else{B(E)}break;default:break}};v.isCurrent=function(E){return s==E};return v})();g.me.state=state;g.me.game=game})(window);(function(b,c){var a=me.ScreenObject.extend({init:function(){this.parent(true);this.logo1=new me.Font("century gothic",32,"white");this.logo2=new me.Font("century gothic",32,"#89b002");this.logo2.bold();this.invalidate=false;this.loadPercent=0;me.loader.onProgress=this.onProgressUpdate.bind(this)},onDestroyEvent:function(){this.logo1=this.logo2=null},onProgressUpdate:function(d){this.loadPercent=d;this.invalidate=true},update:function(){if(this.invalidate===true){this.invalidate=false;return true}return false},draw:function(d){var f=d.canvas.height/2;me.video.clearSurface(d,"black");logo1_width=this.logo1.measureText(d,"melon").width;logo_width=logo1_width+this.logo2.measureText(d,"JS").width;this.logo1.draw(d,"melon",((d.canvas.width-logo_width)/2),(d.canvas.height+60)/2);this.logo2.draw(d,"JS",((d.canvas.width-logo_width)/2)+logo1_width,(d.canvas.height+60)/2);f+=40;var e=Math.floor(this.loadPercent*d.canvas.width);d.strokeStyle="silver";d.strokeRect(0,f,d.canvas.width,6);d.fillStyle="#89b002";d.fillRect(2,f+2,e-4,2)},});loader=(function(){var l={};var f=[];var d={};var m=0;var h=0;var j=0;var i=0;function g(){if(h==(m-i)){for(var o in d){if(d[o].isTMX){me.levelDirector.addTMXLevel(o);l.onResourceLoaded()}}if(l.onload){j=setTimeout(l.onload,300)}else{alert("no load callback defined")}}else{j=setTimeout(g,100)}}function k(o){throw"melonJS: Failed loading image resource"}function n(o){f.push(o.name);f[o.name]=new Image();f[o.name].onload=l.onResourceLoaded.bind(l);f[o.name].onerror=k.bind(this);f[o.name].src=o.src+me.nocache}function e(q,o){if(b.XMLHttpRequest){xmlhttp=new XMLHttpRequest();if(xmlhttp.overrideMimeType){xmlhttp.overrideMimeType("text/xml")}}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.open("GET",q.src+me.nocache,false);xmlhttp.onload=l.onResourceLoaded.bind(l);xmlhttp.send();d[q.name]={};d[q.name].xml=xmlhttp.responseText;d[q.name].isTMX=o||false;if(d[q.name].isTMX){m+=1;i+=1}}l.onload=c;l.onProgress=c;l.onResourceLoaded=function(o){h++;if(l.onProgress){l.onProgress(l.getLoadProgress())}};l.preload=function(q){me.audio.setLoadCallback(l.onResourceLoaded.bind(l));for(var o=0;o<q.length;o++){switch(q[o].type){case"image":n(q[o]);m+=1;break;case"audio":if(me.audio.isAudioEnable()){me.audio.load(q[o]);m+=1}break;case"tmx":e(q[o],true);m+=1;break;default:throw"melonJS: loader : unknow resource type : %s"+q[o].type;break}}g()};l.getXML=function(o){if(d!=null){return d[o].xml}else{return null}};l.getImage=function(o){if(f[o]!=null){if(me.sys.cacheImage===true){var q=me.video.createCanvasSurface(f[o].width,f[o].height);q.drawImage(f[o],0,0);return q.canvas}else{return f[o]}}else{return null}};l.getLoadProgress=function(){return h/m};return l})();b.me.loader=loader;b.me.DefaultLoadingScreen=a})(window);(function(a,b){Vector2d=Object.extend({x:0,y:0,init:function(c,d){this.x=c||0;this.y=d||0},set:function(c,d){this.x=c;this.y=d},setZero:function(){this.set(0,0)},setV:function(c){this.x=c.x;this.y=c.y},add:function(c){this.x+=c.x;this.y+=c.y},sub:function(c){this.x-=c.x;this.y-=c.y},scale:function(c){this.x*=c.x;this.y*=c.y},div:function(c){this.x/=c;this.y/=c},abs:function(){if(this.x<0){this.x=-this.x}if(this.y<0){this.y=-this.y}},clamp:function(c,d){return new Vector2d(this.x.clamp(c,d),this.y.clamp(c,d))},minV:function(c){this.x=this.x<c.x?this.x:c.x;this.y=this.y<c.y?this.y:c.y},maxV:function(c){this.x=this.x>c.x?this.x:c.x;this.y=this.y>c.y?this.y:c.y},negate:function(){return new Vector2d(-this.x,-this.y)},negateSelf:function(){this.x=-this.x;this.y=-this.y},copy:function(c){this.x=c.x;this.y=c.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var c=this.length();if(c<Number.MIN_VALUE){return 0}var d=1/c;this.x*=d;this.y*=d;return c},dotProduct:function(c){return this.x*c.x+this.y*c.y},distance:function(c){return Math.sqrt((this.x-c.x)*(this.x-c.x)+(this.y-c.y)*(this.y-c.y))},clone:function(){return new Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+"y:"+this.y},});Rect=Object.extend({pos:null,colPos:null,left:null,right:null,top:null,bottom:null,width:0,height:0,hWidth:0,hHeight:0,tthis:null,trect:null,init:function(d,c,e){this.pos=d;this.colPos=new Vector2d();this.width=c;this.height=e;this.hWidth=~~(c/2);this.hHeight=~~(e/2);this.tthis=new Vector2d();this.trect=new Vector2d();Object.defineProperty(this,"left",{get:function(){return this.pos.x},configurable:true});Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.width},configurable:true});Object.defineProperty(this,"top",{get:function(){return this.pos.y},configurable:true});Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.height},configurable:true})},set:function(d,c,e){this.pos=d;this.width=c;this.height=e;this.hWidth=~~(c/2);this.hHeight=~~(e/2)},getRect:function(){return new me.Rect(this.pos.clone(),this.width,this.height)},merge:function(c){if(this.pos.x>c.pos.x){this.width+=this.pos.x-c.pos.x;this.pos.x=c.pos.x}else{this.width+=c.pos.x-this.pos.x}if(this.pos.y>c.pos.y){this.height+=this.pos.y-c.pos.y;this.pos.y=c.pos.y}else{this.height+=c.pos.y-this.pos.y}return this},adjustSize:function(c,d,f,e){if(c!=-1){this.colPos.x=c;this.width=d;this.hWidth=~~(this.width/2);Object.defineProperty(this,"left",{get:function(){return this.pos.x+this.colPos.x},configurable:true});Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.colPos.x+this.width},configurable:true})}if(f!=-1){this.colPos.y=f;this.height=e;this.hHeight=~~(this.height/2);Object.defineProperty(this,"top",{get:function(){return this.pos.y+this.colPos.y},configurable:true});Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.colPos.y+this.height},configurable:true})}},flipX:function(c){this.colPos.x=c-this.width-this.colPos.x;this.hWidth=~~(this.width/2)},flipY:function(c){this.colPos.y=c-this.height-this.colPos.y;this.hHeight=~~(this.height/2)},checkAxisAligned:function(c){this.tthis.x=this.left;this.tthis.y=this.top;this.trect.x=c.left;this.trect.y=c.top;return(this.tthis.x<this.trect.x+c.width&&this.trect.x<this.tthis.x+this.width&&this.tthis.y<this.trect.y+c.height&&this.trect.y<this.tthis.y+this.height)},collideVsAABB:function(e){p=new Vector2d(0,0);if(this.checkAxisAligned(e)){var d=this.tthis.x+this.hWidth-this.trect.x-e.hWidth;var c=this.tthis.y+this.hHeight-this.trect.y-e.hHeight;p.x=(e.hWidth+this.hWidth)-(d<0?-d:d);p.y=(e.hHeight+this.hHeight)-(c<0?-c:c);if(p.x<p.y){p.y=0;p.x=d<0?-p.x:p.x}else{p.x=0;p.y=c<0?-p.y:p.y}}return p},draw:function(d,c){d.strokeStyle=c||"red";d.strokeRect(this.left-me.game.viewport.pos.x,this.top-me.game.viewport.pos.y,this.width,this.height)}});a.me.Vector2d=Vector2d;a.me.Rect=Rect})(window);(function(b,d){var a=Math.min,c=Math.max;ViewportEntity=me.Rect.extend({AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},limits:null,target:null,follow_axis:0,_shake:null,_fadeIn:null,_fadeOut:null,_deadwidth:0,_deadheight:0,_limitwidth:0,_limitheight:0,init:function(e,j,i,h,f,g){this.parent(new me.Vector2d(e,j),i-e,h-j);this.limits=new me.Vector2d(f||this.width,g||this.height);this.target=null;this.follow_axis=this.AXIS.NONE;this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null};this._fadeOut={color:0,alpha:0,duration:0,onComplete:null};this._fadeIn={color:0,alpha:0,duration:0,onComplete:null};this.setDeadzone(this.width/6,this.height/6)},_followH:function(e){if((e.x-this.pos.x)>(this._deadwidth)){this.pos.x=~~a((e.x)-(this._deadwidth),this._limitwidth)}else{if((e.x-this.pos.x)<(this.deadzone.x)){this.pos.x=~~c((e.x)-this.deadzone.x,0)}}},_followV:function(e){if((e.y-this.pos.y)>(this._deadheight)){this.pos.y=~~a((e.y)-(this._deadheight),this._limitheight)}else{if((e.y-this.pos.y)<(this.deadzone.y)){this.pos.y=~~c((e.y)-this.deadzone.y,0)}}},reset:function(e,f){this.pos.x=e||0;this.pos.y=f||0;this.target=null;this.follow_axis=null},setDeadzone:function(e,f){this.deadzone=new me.Vector2d(~~((this.width-e)/2),~~((this.height-f)/2-f*0.25));this._deadwidth=this.width-this.deadzone.x;this._deadheight=this.height-this.deadzone.y;this.update(true)},setBounds:function(e,f){this.limits.set(e,f);this._limitwidth=this.limits.x-this.width;this._limitheight=this.limits.y-this.height},follow:function(f,e){this.target=f;this.follow_axis=e||this.AXIS.NONE},move:function(e,f){newx=~~(this.pos.x+e);newy=~~(this.pos.y+f);if((newx>=0)&&(newx<=this._limitwidth)){this.pos.x=newx}if((newy>=0)&&(newy<=this._limitheight)){this.pos.y=newy}},update:function(g){if(this.target&&(g||(this._shake.duration>0))){switch(this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:this._followH(this.target);break;case this.AXIS.VERTICAL:this._followV(this.target);break;case this.AXIS.BOTH:this._followH(this.target);this._followV(this.target);break;default:break}}if(this._shake.duration>0){this._shake.duration-=me.timer.tick;if(this._shake.duration<0){if(this._shake.onComplete){this._shake.onComplete()}}else{if((this._shake.axis==this.AXIS.BOTH)||(this._shake.axis==this.AXIS.HORIZONTAL)){var f=(Math.random()*this._shake.intensity);if(this.pos.x+this.width+f<this.limits.x){this.pos.x+=~~f}else{this.pos.x-=~~f}}if((this._shake.axis==this.AXIS.BOTH)||(this._shake.axis==this.AXIS.VERTICAL)){var e=(Math.random()*this._shake.intensity);if(this.pos.y+this.height+e<this.limits.y){this.pos.y+=~~e}else{this.pos.y-=~~e}}g=true}}if(this._fadeIn.alpha<1){this._fadeIn.alpha+=me.timer.tick/this._fadeIn.duration;if(this._fadeIn.alpha>=1){this._fadeIn.alpha=1;if(this._fadeIn.onComplete){this._fadeIn.onComplete()}}g=true}if(this._fadeOut.alpha>0){this._fadeOut.alpha-=me.timer.tick/this._fadeOut.duration;if(this._fadeOut.alpha<=0){this._fadeOut.alpha=0;if(this._fadeOut.onComplete){this._fadeOut.onComplete()}}g=true}return g},shake:function(e,h,f,g){f=f||this.AXIS.BOTH;if(f==this.AXIS.BOTH){if(this.width==this.limits.x){f=this.AXIS.VERTICAL}else{if(this.height==this.limits.y){f=this.AXIS.HORIZONTAL}}}if((f==this.AXIS.HORIZONTAL)&&(this.width==this.limits.x)){return}if((f==this.AXIS.VERTICAL)&&(this.height==this.limits.y)){return}this._shake.intensity=e;this._shake.duration=h;this._shake.axis=f;this._shake.onComplete=g||null},fadeOut:function(e,g,f){this._fadeOut.color=e;this._fadeOut.duration=g||30;this._fadeOut.alpha=1;this._fadeOut.onComplete=f||null},fadeIn:function(e,g,f){this._fadeIn.color=e;this._fadeIn.duration=g||30;this._fadeIn.alpha=0;this._fadeIn.onComplete=f||null},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(e){this.pos.x=e.x-this.width*0.5;this.pos.y=e.y-this.height*0.5},isVisible:function(e){return this.checkAxisAligned(e)},draw:function(e){if(this._fadeIn.alpha<1){me.video.clearSurface(e,me.utils.HexToRGB(this._fadeIn.color,this._fadeIn.alpha))}if(this._fadeOut.alpha>0){me.video.clearSurface(e,me.utils.HexToRGB(this._fadeOut.color,this._fadeOut.alpha))}}});b.me.Viewport=ViewportEntity})(window);(function(c,e){var a=Math.min;ObjectSettings={image:null,spritewidth:null,type:0,collidable:false};me.ObjectSettings=ObjectSettings;entityPool=(function(){var g={};var f={};g.init=function(){g.add("me.LevelEntity",LevelEntity);g.add("me.ObjectEntity",ObjectEntity);g.add("me.CollectableEntity",CollectableEntity);g.add("me.InvisibleEntity",InvisibleEntity)};g.add=function(i,h){f[i.toLowerCase()]=h};g.newIstanceOf=function(h){if(!f[h.name]){alert("cannot instance entity of type '"+h.name+"': Class not found!");return null}return new f[h.name](h.x,h.y,h)};return g})();c.me.entityPool=entityPool;function d(f,h,g){this.image=me.loader.getImage(f);this.imageWidth=this.image.width;this.imageHeight=this.image.height;this.baseOffset=0;this.z=g||0;this.scrollspeed=h;this.vp_width=me.game.viewport.width}d.prototype.draw=function(i,f,j){var h=0;var g=a(this.imageWidth-f,this.vp_width);do{i.drawImage(this.image,f,0,g,this.imageHeight,h,j,g,this.imageHeight);h+=g;f=0;g=a(this.imageWidth,this.vp_width-h)}while((h<this.vp_width))};function b(f){this.name="parallaxBackgroundEntity";this.visible=true;this.z=f||0;this.vp=me.game.viewport.pos;this.lastx=this.vp.x;this.parallaxLayers=[];this.parallaxLayersCount=0;this.updated=false;this.addLayer=function(g,i,h){this.parallaxLayers.push(new d(g,i,h));this.parallaxLayersCount=0};this.clearTile=function(g,h){};this.update=function(){return this.updated};this.draw=function(k,g,l){g=this.vp.x;if(g>this.lastx){for(var j=0,h;h=this.parallaxLayers[j++];){h.baseOffset=(h.baseOffset+h.scrollspeed*me.timer.tick)%h.imageWidth;h.draw(k,~~h.baseOffset,l);this.lastx=g;this.updated=true}return}else{if(g<this.lastx){for(var j=0,h;h=this.parallaxLayers[j++];){h.baseOffset=(h.imageWidth+(h.baseOffset-h.scrollspeed*me.timer.tick))%h.imageWidth;h.draw(k,~~h.baseOffset,l);this.lastx=g;this.updated=true}return}}for(var j=0,h;h=this.parallaxLayers[j++];){h.draw(k,~~h.baseOffset,l);this.lastx=g;this.updated=false}}}c.me.ParallaxBackgroundEntity=b;SpriteObject=me.Rect.extend({scale:null,lastflipX:false,lastflipY:false,z:0,currentSprite:0,currentSpriteOff:0,scaleFlag:false,autodestroy:true,visible:true,image:null,collisionBox:null,vp:null,fpscount:0,animationspeed:0,init:function(f,i,h,g){this.parent(new me.Vector2d(f,i),g||h.width,h.height);this.image=h;this.spritecount=g?~~(h.width/g):1;this.scale=new me.Vector2d(1,1);this.collisionBox=new me.Rect(this.pos,this.width,this.height);this.vp=me.game.viewport;this.animationspeed=me.sys.fps/10;this.currentSprite=0,this.currentSpriteOff=0;if(this.image.width==g){this.update=function(){return false}}},flipX:function(f){if(f!=this.lastflipX){this.lastflipX=f;this.scale.x=-this.scale.x;this.scaleFlag=((this.scale.x!=1)||(this.scale.y!=1));this.collisionBox.flipX(this.width)}},flipY:function(f){if(f!=this.lastflipY){this.lastflipY=f;this.scale.y=-this.scale.y;this.scaleFlag=((this.scale.x!=1)||(this.scale.y!=1));this.collisionBox.flipY(this.height)}},setCurrentSprite:function(f){this.currentSprite=f;this.currentSpriteOff=this.width*f},update:function(){if(this.visible&&(this.fpscount++>this.animationspeed)){this.setCurrentSprite(++this.currentSprite%this.spritecount);this.fpscount=0;return true}return false},draw:function(g){var f=this.pos.x-this.vp.pos.x,h=this.pos.y-this.vp.pos.y;if(this.scaleFlag){g.scale(this.scale.x,this.scale.y);f=(f*this.scale.x)-(this.scale.x<0?this.width:0);h=(h*this.scale.y)-(this.scale.y<0?this.height:0)}g.drawImage(this.image,this.currentSpriteOff,0,this.width,this.height,~~f,~~h,this.width,this.height);if(this.scaleFlag){g.setTransform(1,0,0,1,0,0)}if(me.debug.renderHitBox){this.parent(g,"blue");this.collisionBox.draw(g,"red")}},destroy:function(){this.onDestroyEvent();if(this.autodestroy){this.image=null;me.game.remove(this)}},onDestroyEvent:function(){}});c.me.SpriteObject=SpriteObject;AnimationSheet=me.SpriteObject.extend({init:function(f,i,h,g){this.anim=[];this.resetAnim=null;this.current=null;this.parent(f,i,h,g);if(this.image.width==g){this.update=function(){return false}}else{this.addAnimation("default",null);this.setCurrentAnimation("default")}},addAnimation:function(g,j){this.anim[g]={name:null,frame:[],idx:0,length:0};if(j==null){for(var h=0;h<this.spritecount;h++){this.anim[g].frame[h]=h*this.width}}else{var f=0;for(var h=0;h<j.length;h++){this.anim[g].frame[f]=j[h]*this.width;f++}}this.anim[g].name=g;this.anim[g].length=this.anim[g].frame.length},setCurrentAnimation:function(f,g){this.current=this.anim[f];this.resetAnim=g||null;this.currentSpriteOff=this.current.frame[this.current.idx]},isCurrentAnimation:function(f){return(this.current.name==f)},setCurrentSprite:function(f){this.current.idx=f;this.currentSpriteOff=this.current.frame[f]},update:function(){if(this.visible&&(this.fpscount++>this.animationspeed)){this.setCurrentSprite(++this.current.idx%this.current.length);if((this.current.idx==0)&&this.resetAnim){this.setCurrentAnimation(this.resetAnim)}this.fpscount=0;return true}return false}});c.me.AnimationSheet=AnimationSheet;ObjectEntity=AnimationSheet.extend({type:0,collidable:false,init:function(f,h,g){this.parent(f,h,(typeof g.image=="string")?me.loader.getImage(g.image):g.image,g.spritewidth);this.pos.set(f,h+me.game.currentLevel.tileheight-this.height);this.vel=new me.Vector2d();this.accel=new me.Vector2d();this.gravity=0.98;this.isEntity=true;this.canBreakTile=false;this.alive=true;this.falling=false;this.jumping=false;this.jumpspeed=0;this.slopeY=0;this.onslope=false;this.onladder=false;this.collidable=g.collidable||false;this.type=g.type||0;this.flickering=false;this.flickerTimer=-1;this.flickercb=null;this.collisionMap=me.game.collisionMap;this.onTileBreak=null},updateColRect:function(f,g,j,i){this.collisionBox.adjustSize(f,g,j,i)},checkCollision:function(g){var f=this.collisionBox.collideVsAABB(g.collisionBox);if(f.x!=0||f.y!=0){this.onCollision(f,g);f.type=this.type;return f}return null},onCollision:function(f,g){if(this.collidable&&(this.type==me.game.COLLECTABLE_OBJECT)){this.destroy()}},setVelocity:function(f,g){this.accel.x=(f!=0)?f:this.accel.x;this.accel.y=(f!=0)?g:this.accel.y},doWalk:function(f){this.flipX(f);this.vel.x=(f)?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick},doClimb:function(f){if(this.onladder){this.vel.y=(f)?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick;return true}return false},doJump:function(){if(!this.jumping&&!this.falling){this.jumpspeed=this.accel.y;this.jumping=true;if(this.onslope){}return true}return false},forceJump:function(){this.jumping=false;this.falling=false;this.doJump()},checkSlope:function(f,g){this.pos.y=f.pos.y-this.height;if(g){this.slopeY=f.height-(this.collisionBox.right+this.vel.x-f.pos.x)}else{this.slopeY=(this.collisionBox.left+this.vel.x-f.pos.x)}this.slopeY=this.slopeY.clamp(0,f.height);if((this.vel.x!=0)||this.falling){this.vel.y=this.slopeY}else{this.vel.y=0;this.pos.y+=this.slopeY}},updateMovement:function(){if(this.jumping){this.jumpspeed-=this.gravity;if((this.jumpspeed<0)){this.jumping=false;this.falling=true;this.vel.y=0}else{this.vel.y=-this.jumpspeed}}else{if(!this.onladder){this.falling=true;this.vel.y+=(this.gravity*me.timer.tick)}}collision=this.collisionMap.checkCollision(this.collisionBox,this.vel);this.onladder=collision.xprop.isLadder;this.onslope=collision.yprop.isSlope||collision.xprop.isSlope;if(collision.y){if(this.vel.y>0){if(collision.yprop.isSolid||(collision.yprop.isPlatform&&(~~this.pos.y+this.height<=collision.ytile.pos.y))){this.pos.y=~~this.pos.y;this.vel.y=(this.falling)?collision.ytile.pos.y-this.pos.y-this.height:0;this.falling=false}else{if(collision.yprop.isSlope&&!this.jumping){this.checkSlope(collision.ytile,collision.yprop.isLeftSlope);this.falling=false}else{if(collision.yprop.isBreakable){if(this.canBreakTile){me.game.currentLevel.clearTile(collision.ytile.row,collision.ytile.col);if(this.onTileBreak){this.onTileBreak()}}else{this.pos.y=~~this.pos.y;this.vel.y=(this.falling)?collision.ytile.pos.y-this.pos.y-this.height:0;this.falling=false}}}}}else{if(this.vel.y<0){if(!collision.yprop.isPlatform&&!collision.yprop.isLadder){this.jumping=false;this.falling=true;this.vel.y=0}}}}if(collision.x){if(collision.xprop.isSlope&&!this.jumping){this.checkSlope(collision.xtile,collision.xprop.isLeftSlope);this.falling=false}else{if(!collision.xprop.isPlatform&&!collision.xprop.isLadder){if(collision.xprop.isBreakable&&this.canBreakTile){me.game.currentLevel.clearTile(collision.xtile.row,collision.xtile.col);if(this.onTileBreak){this.onTileBreak()}}else{this.vel.x=0}}}}this.updateFlickering();if((this.vel.x!=0)||(this.vel.y!=0)){this.pos.add(this.vel);if((this.onslope&&!this.jumping)||this.onladder){this.vel.y=0}return true}return false},updateFlickering:function(){if(this.flickering){this.flickerTimer-=me.timer.tick;if(this.flickerTimer<0){if(this.flickercb){this.flickercb()}this.flicker(-1)}else{this.visible=!this.visible;return true}}return false},flicker:function(f,g){this.flickerTimer=f;if(this.flickerTimer<0){this.flickering=false;this.visible=true;this.flickercb=null}else{if(!this.flickering){this.flickercb=g;this.flickering=true}}}});c.me.ObjectEntity=ObjectEntity;CollectableEntity=ObjectEntity.extend({init:function(f,h,g){this.parent(f,h,g);this.collidable=true;this.type=me.game.COLLECTABLE_OBJECT}});c.me.CollectableEntity=CollectableEntity;InvisibleEntity=me.Rect.extend({z:0,collisionBox:null,init:function(f,h,g){this.parent(new me.Vector2d(f,h),g.width,g.height);this.collisionBox=new me.Rect(this.pos,g.width,g.height);this.visible=true;this.collidable=true;this.isEntity=true},updateColRect:function(f,g,j,i){this.collisionBox.adjustSize(f,g,j,i)},checkCollision:function(g){var f=this.collisionBox.collideVsAABB(g.collisionBox);if(f.x!=0||f.y!=0){this.onCollision(f,g);f.type=this.type;return f}return null},onCollision:function(f,g){if(this.collidable&&(this.type==me.game.COLLECTABLE_OBJECT)){this.destroy()}},update:function(){return false},draw:function(f){if(me.debug.renderHitBox){f.strokeStyle="blue";f.strokeRect(this.pos.x-me.game.viewport.pos.x,this.pos.y-me.game.viewport.pos.y,this.width,this.height);this.collisionBox.draw(f)}}});c.me.InvisibleEntity=InvisibleEntity;LevelEntity=InvisibleEntity.extend({init:function(f,h,g){this.parent(f,h,g);this.nextlevel=g.to;this.fade=g.fade;this.duration=g.duration;this.fading=false;this.gotolevel=g.to},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel);me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(f){this.gotolevel=f||this.nextlevel;if(this.fade&&this.duration){if(!this.fading){this.fading=true;me.game.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))}}else{me.levelDirector.loadLevel(this.gotolevel)}},onCollision:function(){this.goTo()}});c.me.LevelEntity=LevelEntity})(window);(function(a,b){Font=Object.extend({ALIGN:{LEFT:"left",CENTER:"center",RIGHT:"right"},font:null,height:null,color:null,align:null,init:function(d,e,c,f){this.set(d,e,c,f)},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},set:function(d,e,c,f){this.font=""+e+"px "+d;this.height=e;this.color=c;this.align=f||"top"},measureText:function(c,d){c.font=this.font;c.fillStyle=this.color;c.textBaseLine=this.align;dim=c.measureText(d);dim.height=this.height;return dim},draw:function(d,e,c,f){d.font=this.font;d.fillStyle=this.color;d.textBaseLine=this.align;d.fillText(e,~~c,~~f)}});BitmapFont=Font.extend({size:null,sSize:null,scale:1,firstChar:32,init:function(c,d,f,e){this.parent(c,null,null);this.size=new me.Vector2d(d,0);this.sSize=new me.Vector2d();this.scale=f||1;this.firstChar=e||32;this.loadFontMetrics(c);this.align=this.ALIGN.RIGHT},loadFontMetrics:function(c){this.font=me.loader.getImage(c);this.size.y=this.font.height||0;this.sSize.copy(this.size);this.sSize.x*=this.scale;this.sSize.y*=this.scale},set:function(d,c){this.align=d;if(c){this.sSize.copy(this.size);this.sSize.x*=this.scale;this.sSize.y*=this.scale}},measureText:function(c){return{width:c.length*this.sSize.x,height:this.sSize.y}},draw:function(e,f,c,g){if(typeof(f)!="string"){f=f.toString()}if(this.align==this.ALIGN.RIGHT){c-=f.length*this.sSize.x}for(var d=0;d<f.length;d++){e.drawImage(this.font,(f.charCodeAt(d)-this.firstChar)*this.size.x,0,this.sSize.x,this.sSize.y,~~c,~~g,this.size.x,this.size.y);c+=this.sSize.x}}});a.me.Font=Font;a.me.BitmapFont=BitmapFont})(window);(function(b,c){var a=me.SpriteObject.extend({isClickable:true,updated:false,init:function(d,g,f,e){this.parent(this,d,g,f,e)},update:function(){if(this.updated){this.updated=false;return true}return false},clicked:function(){return false},mouseEvent:function(d,e){if((d>this.pos.x)&&(d<this.pos.x+this.displayWidth)&&(e>this.pos.y)&&(e<this.pos.y+this.displayHeight)){if(this.isClickable){this.updated=this.clicked()}}return this.updated}});b.me.GUI_Object=a})(window);(function(a,b){HUD_Item=Object.extend({init:function(c,e,d){this.pos=new me.Vector2d(c||0,e||0);this.visible=true;this.defaultvalue=d||0;this.value=d||0;this.updated=true},reset:function(){this.value=this.defaultvalue;this.updated=true},update:function(c){this.value+=c;this.updated=true;return this.updated},draw:function(d,c,e){if(this.updated){this.updated=false}}});HUD_Object=me.Rect.extend({init:function(c,g,d,f,e){this.parent(new me.Vector2d(c||0,g||0),d||me.video.getWidth(),f||me.video.getHeight());this.bgcolor=e;this.HUDItems={};this.HUDobj=[];this.objCount=0;this.visible=true;this.HUD_invalidated=true;HUDCanvasSurface=me.video.createCanvasSurface(this.width,this.height);this.z=999},addItem:function(c,d){this.HUDItems[c]=d;this.HUDobj.push(this.HUDItems[c]);this.objCount++;this.HUD_invalidated=true},updateItemValue:function(c,d){if(this.HUDItems[c]&&(this.HUDItems[c].update(d)==true)){this.HUD_invalidated=true}},getItemValue:function(c){return(this.HUDItems[c])?this.HUDItems[c].value:0},update:function(){return this.HUD_invalidated},reset:function(c){if(this.HUDItems[c]){this.HUDItems[c].reset()}this.HUD_invalidated=true},resetAll:function(){for(var c=this.objCount,d;c--,d=this.HUDobj[c];){d.reset()}this.HUD_invalidated=true},getRect:function(){p=this.pos.clone();p.add(me.game.viewport.pos);return new me.Rect(p,this.width,this.height)},draw:function(e,c,g){if(this.HUD_invalidated){if(this.bgcolor){me.video.clearSurface(HUDCanvasSurface,this.bgcolor)}else{HUDCanvasSurface.canvas.width=HUDCanvasSurface.canvas.width}for(var d=this.objCount,f;d--,f=this.HUDobj[d];){if(f.visible){f.draw(HUDCanvasSurface,c,g)}}}e.drawImage(HUDCanvasSurface.canvas,this.pos.x,this.pos.y);this.HUD_invalidated=false}});a.me.HUD_Item=HUD_Item;a.me.HUD_Object=HUD_Object})(window);(function(a,b){audio=(function(){var j={};var s=[];var c=["mp3","ogg","wav"];var g=null;var r=-1;var e=null;var m=null;var k=true;var q=0;var l=0;function h(){var t=0;if(!me.sys.sound){k=false;return}if((g.search(/mp3/i)!=-1)&&j.capabilities.mp3){return c[t]}if((g.search(/ogg/i)!=-1)&&j.capabilities.ogg){return c[++t]}if((g.search(/wav/i)!=-1)&&j.capabilities.wav){return c[++t]}k=false;return -1}function f(u){var t=s[u];for(var v=0,w;w=t[v++];){if(w.ended||!w.currentTime){w.currentTime=q;return w}}t[0].pause();t[0].currentTime=q;return t[0]}function n(t){if(l++>3){throw"melonJS: failed loading audio: "+t+"."+r}else{s[t][0].load()}}function d(t,v){l=0;if(v>1){var u=s[t][0];for(channel=1;channel<v;channel++){s[t][channel]=u.cloneNode(true);s[t][channel].load()}}if(e){e()}}function o(u,t,w){var v=f(u);v.loop=t||false;v.play();if(w&&!t){v.addEventListener("ended",function(z){v.removeEventListener("ended",arguments.callee,false);w()},false)}}function i(u,t,v){if(v&&!t){setTimeout(v,2000)}}j.capabilities={mp3:false,ogg:false,ma4:false,wav:false,};j.init=function(t){if(t){g=new String(t)}else{g=new String("mp3")}r=h();if(k){j.play=o}else{j.play=i}return k};j.setLoadCallback=function(t){e=t};j.isAudioEnable=function(){return k};j.enable=function(){k=me.sys.sound;if(k){j.play=o}else{j.play=i}};j.disable=function(){k=false;j.play=i};j.load=function(u){if(r==-1){return 0}var t=new Audio(u.src+u.name+"."+r+me.nocache);t.preload="auto";t.addEventListener("canplaythrough",function(v){this.removeEventListener("canplaythrough",arguments.callee,false);d(u.name,u.channel)},false);t.addEventListener("error",function(v){n(u.name)},false);t.src=u.src+u.name+"."+r+me.nocache;t.load();s[u.name]=[t];return 1};j.stop=function(t){if(k){var u=s[t];for(channel_id=u.length;channel_id--;){u[channel_id].pause();u[channel_id].currentTime=q}}};j.pause=function(t){if(k){var u=s[t];for(channel_id=u.length;channel_id--;){u[channel_id].pause()}}};j.playTrack=function(t){if(k){if(m!=null){j.stopTrack()}m=f(t);if(m){m.loop=true;m.play()}}};j.stopTrack=function(){if(k&&m){m.pause();m=null}};j.pauseTrack=function(){if(k&&m){m.pause()}};j.resumeTrack=function(){if(k&&m){m.play()}};return j})();a.me.audio=audio})(window);(function(a,b){timer=(function(){var h={};var m=null;var c=false;var g=0;var i=0;var e=0;var l=0;var d=0;var k=0;var f=Math.ceil(1000/me.sys.fps);var n=(1000/me.sys.fps)*1.25;function j(){m.replaceChild(document.createTextNode("("+e+"/"+me.sys.fps+" fps)"),m.firstChild)}h.tick=1;h.init=function(){m=document.getElementById("framecounter");c=(m!==null);h.reset()};h.reset=function(){d=l=new Date().getTime();i=0;g=0};h.getTime=function(){return d};h.update=function(){l=d;d=new Date().getTime();k=(d-l);if(c){g++;i+=k;if(g%10==0){e=Math.ceil((1000*g)/i);j();i=0;g=0}}h.tick=(k>n&&me.sys.interpolation)?k/f:1};return h})();video=(function(){var g={};var e=null;var i=null;var j=null;var h=null;var d=null;var k=false;var f=0;var c=0;g.init=function(n,q,m,l,o){k=l||false;me.sys.scale=k===true?o||1:1;f=q*me.sys.scale;c=m*me.sys.scale;d=document.getElementById(n);e=document.createElement("canvas");e.setAttribute("width",(f)+"px");e.setAttribute("height",(c)+"px");e.setAttribute("border","0px solid black");d.appendChild(e);if(e.getContext){i=e.getContext("2d");if(k){h=g.createCanvasSurface(q,m);j=h.canvas}else{h=i;j=i.canvas}}else{return false}return true};g.getWrapper=function(){return d};g.getWidth=function(){return j.width};g.getHeight=function(){return j.height};g.createCanvasSurface=function(m,l){var n=document.createElement("canvas");n.width=m||j.width;n.height=l||j.height;return n.getContext("2d")};g.getScreenCanvas=function(){return e};g.getScreenFrameBuffer=function(){return h};g.updateDisplaySize=function(l){if(k){if(l){me.sys.scale=l}else{me.sys.scale=document.getElementById("screen size").value}f=j.width*me.sys.scale;c=j.height*me.sys.scale;e.width=f;e.height=c}};g.clearSurface=function(m,l){m.fillStyle=l;m.fillRect(0,0,m.canvas.width,m.canvas.height)};g.scale=function(l,m){l.translate(-(((l.canvas.width*m)-l.canvas.width)>>1),-(((l.canvas.height*m)-l.canvas.height)>>1));l.scale(m,m)};g.setAlpha=function(m,l){m.globalCompositeOperation=l?"source-over":"copy"};g.blitSurface=function(){if(k){g.blitSurface=function(){i.drawImage(j,0,0,j.width,j.height,0,0,f,c)}}else{g.blitSurface=function(){}}g.blitSurface()};g.applyRGBFilter=function(){if(typeof arguments[0]=="string"){var w=arguments[0];var r=arguments[1];var s=g.createCanvasSurface();var t=h.getImageData(0,0,j.width,j.height)}else{var s=g.createCanvasSurface(arguments[0].width,arguments[0].height);if(arguments[0] instanceof HTMLImageElement){var o=me.video.createCanvasSurface(arguments[0].width,arguments[0].height);o.drawImage(arguments[0],0,0);var t=o.getImageData(0,0,arguments[0].width,arguments[0].height)}else{var t=arguments[0].getContext("2d").getImageData(0,0,arguments[0].width,arguments[0].height)}var w=arguments[1];var r=arguments[2]}var u=t.data;switch(w){case"b&w":for(var q=0,m=u.length;q<m;q+=4){var l=(3*u[q]+4*u[q+1]+u[q+2])>>>3;u[q]=l;u[q+1]=l;u[q+2]=l}break;case"brightness":var v=Math.abs(r);v=(v>1)?1:v;for(var q=0,m=u.length;q<m;q+=4){u[q]*=v;u[q+1]*=v;u[q+2]*=v}break;case"transparent":for(var q=0,m=u.length;q<m;q+=4){if(me.utils.RGBToHex(u[q],u[q+1],u[q+2])===r){u[q+3]=0}}break;default:return null}s.putImageData(t,0,0);return s};return g})();a.me.timer=timer;a.me.video=video})(window);(function(a,b){input=(function(){var h={};var f=[];var k=[];var n=[];var d=[];var g=null;var j=null;var m=false;function o(r){if(r){if(!m){a.addEventListener("keydown",e,false);a.addEventListener("keyup",c,false)}}else{a.removeEventListener("keydown",e,false);a.removeEventListener("keyup",c,false)}m=r}function l(r){r.stopPropagation();if(r.preventDefault){r.preventDefault()}r.returnValue=false}function e(s){var r=f[s.keyCode||s.which];if(r){if(!d[r]){k[r]=true;d[r]=n[r]}l(s);return false}return true}function c(s){var r=f[s.keyCode||s.which];if(r){k[r]=false;d[r]=false;l(s);return false}return true}function i(s){var r=s.clientX-me.video.getScreenCanvas().offsetLeft;var t=s.clientY-me.video.getScreenCanvas().offsetTop;g(r,t)}function q(r){}h.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,};h.isKeyPressed=function(r){if(k[r]){if(n[r]){d[r]=true;k[r]=false}return true}return false};h.keyStatus=function(r){return(d[r]===true)?true:k[r]};h.bindKey=function(r,t,s){if(!m){o(true)}f[r]=t;n[t]=s?s:false;d[t]=false};h.unbindKey=function(r){k[f[r]]=false;n[f[r]]=false;f[r]=null};h.enableMouseEvent=function(r,s){if(r){me.video.getScreenCanvas().addEventListener("click",i,false);g=s||me.game.mouseEvent.bind(me.game)}else{me.video.getScreenCanvas().removeEventListener("click",i,false)}};h.enableGyroscopicEvent=function(r,s){if(a.sys.gyro){a.ondevicemotion=r?q:null;j=r?s:null}};return h})();a.me.input=input})(window);(function(b,d){var c=(function(){var f={};var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";f.decode=function(j){var g=[],r,o,m,q,n,l,k,h=0;j=j.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(h<j.length){q=e.indexOf(j.charAt(h++));n=e.indexOf(j.charAt(h++));l=e.indexOf(j.charAt(h++));k=e.indexOf(j.charAt(h++));r=(q<<2)|(n>>4);o=((n&15)<<4)|(l>>2);m=((l&3)<<6)|k;g.push(String.fromCharCode(r));if(l!=64){g.push(String.fromCharCode(o))}if(k!=64){g.push(String.fromCharCode(m))}}g=g.join("");return g};return f})();var a=(function(){var e={};var f={};e.decodeBase64=function(g){return c.decode(g)};e.decodeBase64AsArray=function(l,h){h=h||1;var o=c.decode(l),k=[],n,m,g;for(n=0,g=o.length/h;n<g;n++){k[n]=0;for(m=h-1;m>=0;--m){k[n]+=o.charCodeAt((n*h)+m)<<(m<<3)}}return k};e.decodeCSV=function(j,h){j=j.trim().split("\n");var g=[];for(var k=0;k<j.length;k++){entries=j[k].split(",",h);for(var l=0;l<entries.length;l++){g.push(+entries[l])}}return g};e.setNocache=function(g){me.nocache=g?"?"+parseInt(Math.random()*10000000):""};e.HexToRGB=function(i,g){i=(i.charAt(0)=="#")?i.substring(1,7):i;if(f[i]==null){f[i]=parseInt(i.substring(0,2),16)+","+parseInt(i.substring(2,4),16)+","+parseInt(i.substring(4,6),16)}return(g?"rgba(":"rgb(")+f[i]+(g?","+g+")":")")};e.RGBToHex=function(j,i,h){return j.toHex()+i.toHex()+h.toHex()};return e})();b.me.utils=a})(window);(function(b,c){function a(d){this.defaultvalue=d||0;this.value=d||0;this.updated=true}a.prototype.reset=function(){this.value=this.defaultvalue;this.updated=true};a.prototype.update=function(d){this.value+=d;this.updated=true;return this.updated};gamestat=(function(){var f={};var e={};var g=[];var d=0;f.add=function(h,i){e[h]=new a(i);g.push(e[h]);d++};f.updateValue=function(h,i){if(e[h]){e[h].update(i)}};f.getItemValue=function(h){return(e[h])?e[h].value:0};f.reset=function(h){if(h!=c){if(e[h]){e[h].reset()}}else{f.resetAll()}};f.resetAll=function(){for(var h=d,j;h--,j=g[h];){j.reset()}};return f})();b.me.gamestat=gamestat})(window);(function(f,g){removepath=/^.*(\\|\/|\:)/;removeext=/\.[^\.]*$/;var e={COLLISION_MAP:"collision",PARALLAX_MAP:"parallax",};var c=me.Rect.extend({init:function(i,m,j,k,l){this.parent(new me.Vector2d(i*j,m*k),j,k);this.tileId=l;this.row=i;this.col=m}});function b(k,l,j,n,m,i){this.name=k;this.tilewidth=l;this.tileheight=j;this.spacing=n;this.margin=m;this.image=(i)?me.loader.getImage(i.replace(removepath,"").replace(removeext,"")):null;this.type={SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder",BREAKABLE:"breakable"};this.TileProperties=[];if(this.image){this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing));this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing))}}b.prototype.getPropertyList=function(){return{isCollidable:false,isSolid:false,isPlatform:false,isSlope:false,isLeftSlope:false,isRightSlope:false,isLadder:false,isBreakable:false}};b.prototype.getTileProperties=function(i){return this.TileProperties[i]};b.prototype.isTileCollidable=function(i){return this.TileProperties[i].isCollidable};b.prototype.getTileImage=function(j){var i=me.video.createCanvasSurface(this.tilewidth,this.tileheight);this.drawTile(i,0,0,j);return i.canvas};b.prototype.drawTile=function(j,i,n,m){var l=this.margin+(this.spacing+this.tilewidth)*(m%this.hTileCount);var k=this.margin+(this.spacing+this.tileheight)*~~(m/this.hTileCount);j.drawImage(this.image,l,k,this.tilewidth,this.tileheight,i,n,this.tilewidth,this.tileheight)};function d(i,j){this.realwidth=i;this.realheight=j;this.isCollisionMap=true}d.prototype.checkCollision=function(l,j){var i=(j.x<0)?l.left+j.x:l.right+j.x-1;var m=(j.y<0)?l.top+j.y:l.bottom+j.y;var k={x:false,y:false,tile:g,xprop:{},yprop:{}};if(i<=0||i>=this.realwidth){k.x=true}if(m<=0||m>=this.realheight){k.y=true}return k};function h(i,j,k,l){this.width=i;this.height=j;this.z=l;this.name=null;this.visible=false;this.layerData=null;this.xLUT={};this.yLUT={};this.tileset=k;if(k){this.tilewidth=k.tilewidth;this.tileheight=k.tileheight}else{this.tilewidth=0;this.tileheight=0}this.realwidth=this.width*this.tilewidth;this.realheight=this.height*this.tileheight}h.prototype.initArray=function(j){this.layerData=[];for(var i=0;i<this.width+1;i++){this.layerData[i]=[];for(var k=0;k<this.height+1;k++){this.layerData[i][k]=null}}if(j){for(var i=0;i<this.width*this.tilewidth;i++){this.xLUT[i]=~~(i/this.tilewidth)}for(var k=0;k<this.height*this.tileheight;k++){this.yLUT[k]=~~(k/this.tileheight)}}};h.prototype.getTileId=function(i,k){var j=this.layerData[this.xLUT[~~i]][this.yLUT[~~k]];return j?j.tileId:null};h.prototype.getTile=function(i,j){return this.layerData[this.xLUT[~~i]][this.yLUT[~~j]]};h.prototype.setTile=function(i,k,j){this.layerData[i][k]=new c(i,k,this.tilewidth,this.tileheight,j)};h.prototype.clearTile=function(i,j){this.layerData[i][j]=null};h.prototype.checkCollision=function(j,i){x=(i.x<0)?j.left+i.x:j.right+i.x;y=(i.y<0)?j.top+i.y:j.bottom+i.y;collide={x:false,xtile:g,xprop:{},y:false,ytile:g,yprop:{}};if(x<=0||x>=this.realwidth){collide.x=true}else{collide.xtile=this.getTile(x,j.bottom-1);if(collide.xtile&&this.tileset.isTileCollidable(collide.xtile.tileId)){collide.x=true;collide.xprop=this.tileset.getTileProperties(collide.xtile.tileId)}else{collide.xtile=this.getTile(x,j.top);if(collide.xtile&&this.tileset.isTileCollidable(collide.xtile.tileId)){collide.x=true;collide.xprop=this.tileset.getTileProperties(collide.xtile.tileId)}}}collide.ytile=this.getTile((i.x<0)?j.left:j.right,y);if(collide.ytile&&this.tileset.isTileCollidable(collide.ytile.tileId)){collide.y=true;collide.yprop=this.tileset.getTileProperties(collide.ytile.tileId)}else{collide.ytile=this.getTile((i.x<0)?j.right:j.left,y);if(collide.ytile&&this.tileset.isTileCollidable(collide.ytile.tileId)){collide.y=true;collide.yprop=this.tileset.getTileProperties(collide.ytile.tileId)}}return collide};h.prototype.update=function(){return false};function a(i,j){this.pos=new me.Vector2d(i,j);this.z=0;this.width=0;this.height=0;this.realwidth=-1;this.realheight=-1;this.tilewidth=0;this.tileheight=0;this.tileset=[];this.mapLayers=[];this.objectGroups=[];this.initialized=false}a.prototype.reset=function(){this.tileset=[];this.mapLayers=[];this.objectGroups=[];this.initialized=false};a.prototype.getObjectGroupByName=function(i){return this.objectGroups[i]};a.prototype.getObjectGroups=function(){return this.objectGroups};a.prototype.getLayerByName=function(j){var l=null;j=j.trim().toLowerCase();for(var k=this.mapLayers.length;k--;){if(this.mapLayers[k].name.contains(j)){l=this.mapLayers[k];break}}if((j.contains(e.COLLISION_MAP))&&(l==null)){l=new d(me.game.currentLevel.realwidth,me.game.currentLevel.realheight)}return l};a.prototype.clearTile=function(j,l){for(var k=this.mapLayers.length;k--;){if(this.mapLayers[k].visible||this.mapLayers[k].isCollisionMap){this.mapLayers[k].clearTile(j,l)}}};a.prototype.addTo=function(j){if(this.visible){j.add(this)}for(var k=this.mapLayers.length;k--;){if(this.mapLayers[k].visible){j.add(this.mapLayers[k])}}};a.prototype.update=function(){return false};levelDirector=(function(){var k={};var i={};var j=null;k.reset=function(){};k.addLevel=function(l){console.log("no level loader defined")};k.addTMXLevel=function(l,m){if(i[l]==null){i[l]=new me.TMXTileMap(l,0,0)}if(m){m()}};k.loadLevel=function(l){if(i[l]===g){console.log("level %s not found",l);return}if(i[l] instanceof me.TMXTileMap){me.state.pause();me.game.reset();i[l].reset();i[l].load();j=l;me.game.loadTMXLevel(i[j]);me.state.resume()}else{console.log("no level loader defined")}};k.getCurrentLevelId=function(){return j},k.reloadLevel=function(){return k.loadLevel(j)},k.nextLevel=function(){if(j+1<i.length){return k.loadLevel(j+1)}else{return false}};k.previousLevel=function(){if(j-1>=0){return k.loadLevel(j-1)}else{return false}};return k})();f.me.Tile=c;f.me.TileSet=b;f.me.TiledLayer=h;f.me.TileMap=a;f.me.LevelConstants=e;f.me.levelDirector=levelDirector})(window);(function(C,l){var S="map",D="name",v="value",H="version",P="orientation",K="width",I="height",G="opacity",q="trans",o="tilewidth",a="tileheight",r="firstgid",g="gid",w="tile",z="id",n="data",t="compression",k="encoding",d="base64",h="csv",R="spacing",Q="margin",u="properties",m="property",O="image",f="source",j="visible",F="tileset",N="layer",L="objectgroup",s="object",B="x",A="y",K="width",I="height";function e(X,W){var U=W.getElementsByTagName(u)[0];if(U){var T=U.getElementsByTagName(m);for(var V=0;V<T.length;V++){M(X,T[V])}}}function M(T,W){var V=me.XMLParser.getStringAttribute(W,D);var U=me.XMLParser.getStringAttribute(W,v);if(!U||U.isBoolean()){U=U?(U=="true"):true}else{if(U.isNumeric()){U=parseInt(U)}}T[V]=U}function J(U,T,V){me.TileMap.call(this,T,V);this.xmlMap=me.loader.getXML(U);if(!this.xmlMap){throw"melonJS:"+U+" TMX map not found"}this.version="";this.orientation="";this.tileMapCanvas=null}J.prototype=new me.TileMap();J.prototype.load=function(){if(this.initialized){return}var Y=0,aa=1;me.XMLParser.parseFromString(this.xmlMap);var ab=me.XMLParser.getAllTagElements();for(var Z=0;Z<ab.length;Z++){var W=ab.item(Z).nodeName;switch(W){case S:var U=ab.item(Z);this.version=me.XMLParser.getStringAttribute(U,H);this.orientation=me.XMLParser.getStringAttribute(U,P);this.width=me.XMLParser.getIntAttribute(U,K);this.height=me.XMLParser.getIntAttribute(U,I);this.tilewidth=me.XMLParser.getIntAttribute(U,o);this.tileheight=me.XMLParser.getIntAttribute(U,a);this.realwidth=this.width*this.tilewidth;this.realheight=this.height*this.tileheight;this.z=Y++;if(this.orientation!="orthogonal"){throw"melonJS: "+this.orientation+" type TMX Tile Map not supported!"}e(this,U);if(this.background_color){this.visible=true;this.background_color=me.utils.HexToRGB(this.background_color)}else{this.visible=false}break;case F:this.tileset.push(new E(ab.item(Z)));break;case N:var V=me.XMLParser.getStringAttribute(ab.item(Z),D);if(V.contains(me.LevelConstants.COLLISION_MAP)){this.mapLayers.push(new c(ab.item(Z),this.tileset,Y++))}else{if(V.contains(me.LevelConstants.PARALLAX_MAP)){var X=(me.XMLParser.getIntAttribute(ab.item(Z),j,1)==1);if(X){var ac={};e(ac,ab.item(Z));parallax_layer=this.getLayerByName(me.LevelConstants.PARALLAX_MAP);if(!parallax_layer){parallax_layer=new me.ParallaxBackgroundEntity(Y);this.mapLayers.push(parallax_layer)}parallax_layer.addLayer(ac.imagesrc,aa++,Y++)}}else{this.mapLayers.push(new c(ab.item(Z),this.tileset,Y++));Y++}}break;case L:var T=me.XMLParser.getStringAttribute(ab.item(Z),D);this.objectGroups.push(new i(T,ab.item(Z),this.tileset[0],Y++));break}}me.XMLParser.free();this.initialized=true};J.prototype.draw=function(T){me.video.clearSurface(T,this.background_color)};function E(U){this.firstgid=me.XMLParser.getIntAttribute(U,r);me.TileSet.call(this,me.XMLParser.getStringAttribute(U,D),me.XMLParser.getIntAttribute(U,o),me.XMLParser.getIntAttribute(U,a),me.XMLParser.getIntAttribute(U,R,0),me.XMLParser.getIntAttribute(U,Q,0),U.getElementsByTagName(O)[0].getAttribute(f));this.trans=U.getElementsByTagName(O)[0].getAttribute(q);if(this.trans!==null&&this.image){this.image=me.video.applyRGBFilter(this.image,"transparent",this.trans.toUpperCase()).canvas}var T=U.getElementsByTagName(w);for(var V=0;V<T.length;V++){var W=me.XMLParser.getIntAttribute(T[V],z)+this.firstgid;this.TileProperties[W]={};tileProp=this.TileProperties[W];e(tileProp,T[V]);tileProp.isSolid=tileProp.type?tileProp.type.toLowerCase()===this.type.SOLID:false;tileProp.isPlatform=tileProp.type?tileProp.type.toLowerCase()===this.type.PLATFORM:false;tileProp.isLeftSlope=tileProp.type?tileProp.type.toLowerCase()===this.type.L_SLOPE:false;tileProp.isRightSlope=tileProp.type?tileProp.type.toLowerCase()===this.type.R_SLOPE:false;tileProp.isBreakable=tileProp.type?tileProp.type.toLowerCase()===this.type.BREAKABLE:false;tileProp.isLadder=tileProp.type?tileProp.type.toLowerCase()===this.type.LADDER:false;tileProp.isSlope=tileProp.isLeftSlope||tileProp.isRightSlope;tileProp.isCollidable=tileProp.isSolid||tileProp.isPlatform||tileProp.isSlope||tileProp.isLadder||tileProp.isBreakable}}E.prototype=new me.TileSet();function c(U,Y,W){me.TiledLayer.call(this,me.XMLParser.getIntAttribute(U,K),me.XMLParser.getIntAttribute(U,I),Y[0],W);this.layerInvalidated=true;this.name=me.XMLParser.getStringAttribute(U,D);this.visible=(me.XMLParser.getIntAttribute(U,j,1)==1);this.opacity=me.XMLParser.getFloatAttribute(U,G,1);e(this,U);this.isCollisionMap=(this.name.contains(me.LevelConstants.COLLISION_MAP));if(this.isCollisionMap){this.visible=false;if(Y[1]){this.tileset=Y[1]}}this.vp=me.game.viewport;var X=U.getElementsByTagName(n)[0];var V=me.XMLParser.getStringAttribute(X,k,null);var T=me.XMLParser.getStringAttribute(X,t,null);if(V==""){V=null}if(T==""){T=null}if(this.visible){this.layerSurface=me.video.createCanvasSurface(this.width*this.tilewidth,this.height*this.tileheight);this.layerCanvas=this.layerSurface.canvas;if(this.opacity>0&&this.opacity<1){this.layerSurface.globalAlpha=this.opacity}}if(this.visible||this.isCollisionMap){this.initArray(this.isCollisionMap);this.fillArray(X,V,T)}}c.prototype=new me.TiledLayer();c.prototype.fillArray=function(Y,T,ac){switch(ac){case null:switch(T){case null:var U=Y.getElementsByTagName(w);break;case h:case d:var W="";for(var V=0,X=Y.childNodes.length;V<X;V++){W+=Y.childNodes[V].nodeValue}if(T==d){var U=me.utils.decodeBase64AsArray(W,4)}else{var U=me.utils.decodeCSV(W,this.width)}W=null;break;default:throw"melonJS: TMX Tile Map "+T+" encoding not supported!"}break;default:throw"melonJS: "+ac+" compressed TMX Tile Map not supported!"}var ab=U.length-1;for(var Z=this.height-1;Z>=0;Z--){for(var aa=this.width-1;aa>=0;aa--){gid=(T==null)?me.XMLParser.getIntAttribute(U[ab--],g):U[ab--];if(gid>0){this.setTile(aa,Z,gid);if(this.visible){this.tileset.drawTile(this.layerSurface,aa*this.tilewidth,Z*this.tileheight,this.layerData[aa][Z].tileId-this.tileset.firstgid)}}}}U=null};c.prototype.clearTile=function(T,U){me.TiledLayer.prototype.clearTile.call(this,T,U);if(this.visible){this.layerSurface.clearRect(T*this.tilewidth,U*this.tileheight,this.tilewidth,this.tileheight)}};c.prototype.draw=function(U,T,V){U.drawImage(this.layerCanvas,this.vp.pos.x,this.vp.pos.y,this.vp.width,this.vp.height,T,V,this.vp.width,this.vp.height)};function i(U,T,X,Y){this.objects=[];this.name=U;this.width=me.XMLParser.getIntAttribute(T,K);this.height=me.XMLParser.getIntAttribute(T,I);this.z=Y;var W=T.getElementsByTagName(s);for(var V=0;V<W.length;V++){this.objects.push(new b(W[V],X,Y))}}i.prototype.getObjectCount=function(){return this.objects.length};i.prototype.getObjectByIndex=function(T){return this.objects[T]};function b(U,T,V){this.name=me.XMLParser.getStringAttribute(U,D);this.x=me.XMLParser.getIntAttribute(U,B);this.y=me.XMLParser.getIntAttribute(U,A);this.z=V;this.gid=me.XMLParser.getIntAttribute(U,g,null);if(this.gid){this.width=T.tilewidth;this.height=T.tileheight;this.spritewidth=this.width;this.y-=this.height;this.image=T.getTileImage(this.gid-T.firstgid)}else{this.width=me.XMLParser.getIntAttribute(U,K,0);this.height=me.XMLParser.getIntAttribute(U,I,0)}e(this,U)}b.prototype.getObjectPropertyByName=function(T){return this[T]};C.me.TMXTileMap=J})(window);
/*!
 * Tween JS
 * https://github.com/sole/Tween.js
 *
 * author sole / http://soledadpenades.com
 * author mr.doob / http://mrdoob.com
 * author Robert Eisele / http://www.xarg.org
 * author Philippe / http://philippe.elsass.me
 * author Robert Penner / http://www.robertpenner.com/easing_terms_of_use.html
 */
(function(a,b){Tween=function(f){var m=f,l={},i={},j={},g=1000,k=0,c=null,n=Tween.Easing.Linear.EaseNone,e=null,h=null,d=null;this.to=function(o,r){if(r!==null){g=r}for(var q in o){if(m[q]===null){continue}j[q]=o[q]}return this};this.start=function(){me.game.add(this,999);c=me.timer.getTime()+k;for(var o in j){if(m[o]===null){continue}l[o]=m[o];i[o]=j[o]-m[o]}return this};this.stop=function(){this.destroy();return this};this.delay=function(o){k=o;return this};this.easing=function(o){n=o;return this};this.chain=function(o){e=o};this.onUpdate=function(o){h=o;return this};this.onComplete=function(o){d=o;return this};this.update=function(){var r,o,q;var s=me.timer.getTime();if(s<c){return true}o=(s-c)/g;o=o>1?1:o;q=n(o);for(r in i){m[r]=l[r]+i[r]*q}if(h!==null){h.call(m,q)}if(o==1){this.destroy();if(d!==null){d.call(m)}if(e!==null){e.start()}return false}return true};this.destroy=function(){me.game.remove(this)}};Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};Tween.Easing.Linear.EaseNone=function(c){return c};Tween.Easing.Quadratic.EaseIn=function(c){return c*c};Tween.Easing.Quadratic.EaseOut=function(c){return -c*(c-2)};Tween.Easing.Quadratic.EaseInOut=function(c){if((c*=2)<1){return 0.5*c*c}return -0.5*(--c*(c-2)-1)};Tween.Easing.Cubic.EaseIn=function(c){return c*c*c};Tween.Easing.Cubic.EaseOut=function(c){return --c*c*c+1};Tween.Easing.Cubic.EaseInOut=function(c){if((c*=2)<1){return 0.5*c*c*c}return 0.5*((c-=2)*c*c+2)};Tween.Easing.Quartic.EaseIn=function(c){return c*c*c*c};Tween.Easing.Quartic.EaseOut=function(c){return -(--c*c*c*c-1)};Tween.Easing.Quartic.EaseInOut=function(c){if((c*=2)<1){return 0.5*c*c*c*c}return -0.5*((c-=2)*c*c*c-2)};Tween.Easing.Quintic.EaseIn=function(c){return c*c*c*c*c};Tween.Easing.Quintic.EaseOut=function(c){return(c=c-1)*c*c*c*c+1};Tween.Easing.Quintic.EaseInOut=function(c){if((c*=2)<1){return 0.5*c*c*c*c*c}return 0.5*((c-=2)*c*c*c*c+2)};Tween.Easing.Sinusoidal.EaseIn=function(c){return -Math.cos(c*Math.PI/2)+1};Tween.Easing.Sinusoidal.EaseOut=function(c){return Math.sin(c*Math.PI/2)};Tween.Easing.Sinusoidal.EaseInOut=function(c){return -0.5*(Math.cos(Math.PI*c)-1)};Tween.Easing.Exponential.EaseIn=function(c){return c==0?0:Math.pow(2,10*(c-1))};Tween.Easing.Exponential.EaseOut=function(c){return c==1?1:-Math.pow(2,-10*c)+1};Tween.Easing.Exponential.EaseInOut=function(c){if(c==0){return 0}if(c==1){return 1}if((c*=2)<1){return 0.5*Math.pow(2,10*(c-1))}return 0.5*(-Math.pow(2,-10*(c-1))+2)};Tween.Easing.Circular.EaseIn=function(c){return -(Math.sqrt(1-c*c)-1)};Tween.Easing.Circular.EaseOut=function(c){return Math.sqrt(1- --c*c)};Tween.Easing.Circular.EaseInOut=function(c){if((c/=0.5)<1){return -0.5*(Math.sqrt(1-c*c)-1)}return 0.5*(Math.sqrt(1-(c-=2)*c)+1)};Tween.Easing.Elastic.EaseIn=function(d){var e,c=0.1,f=0.4;if(d==0){return 0}if(d==1){return 1}if(!f){f=0.3}if(!c||c<1){c=1;e=f/4}else{e=f/(2*Math.PI)*Math.asin(1/c)}return -(c*Math.pow(2,10*(d-=1))*Math.sin((d-e)*(2*Math.PI)/f))};Tween.Easing.Elastic.EaseOut=function(d){var e,c=0.1,f=0.4;if(d==0){return 0}if(d==1){return 1}if(!f){f=0.3}if(!c||c<1){c=1;e=f/4}else{e=f/(2*Math.PI)*Math.asin(1/c)}return(c*Math.pow(2,-10*d)*Math.sin((d-e)*(2*Math.PI)/f)+1)};Tween.Easing.Elastic.EaseInOut=function(d){var e,c=0.1,f=0.4;if(d==0){return 0}if(d==1){return 1}if(!f){f=0.3}if(!c||c<1){c=1;e=f/4}else{e=f/(2*Math.PI)*Math.asin(1/c)}if((d*=2)<1){return -0.5*(c*Math.pow(2,10*(d-=1))*Math.sin((d-e)*(2*Math.PI)/f))}return c*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*(2*Math.PI)/f)*0.5+1};Tween.Easing.Back.EaseIn=function(c){var d=1.70158;return c*c*((d+1)*c-d)};Tween.Easing.Back.EaseOut=function(c){var d=1.70158;return(c=c-1)*c*((d+1)*c+d)+1};Tween.Easing.Back.EaseInOut=function(c){var d=1.70158*1.525;if((c*=2)<1){return 0.5*(c*c*((d+1)*c-d))}return 0.5*((c-=2)*c*((d+1)*c+d)+2)};Tween.Easing.Bounce.EaseIn=function(c){return 1-Tween.Easing.Bounce.EaseOut(1-c)};Tween.Easing.Bounce.EaseOut=function(c){if((c/=1)<(1/2.75)){return 7.5625*c*c}else{if(c<(2/2.75)){return 7.5625*(c-=(1.5/2.75))*c+0.75}else{if(c<(2.5/2.75)){return 7.5625*(c-=(2.25/2.75))*c+0.9375}else{return 7.5625*(c-=(2.625/2.75))*c+0.984375}}}};Tween.Easing.Bounce.EaseInOut=function(c){if(c<0.5){return Tween.Easing.Bounce.EaseIn(c*2)*0.5}return Tween.Easing.Bounce.EaseOut(c*2-1)*0.5+0.5};a.me.Tween=Tween})(window);